{% extends "base.html" %}
{% from "_formhelpers.html" import render_field %}

{% block title %}Record Offline Payment - ShramBandhu{% endblock %}

{% block content %}
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="max-w-xl mx-auto">
        <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl border border-gray-200">
            <div class="mb-6 pb-3 border-b border-gray-200">
                 <h1 class="text-2xl font-bold text-gray-800">Record Offline Payment</h1>
                 <p class="text-sm text-gray-500 mt-1">Record cash or bank transfer payment for job: <strong>{{ job.title }}</strong></p>
            </div>

             {# Job & Worker Summary #}
            <div class="mb-6 p-4 border rounded-lg bg-gray-50 text-sm space-y-2">
                <p><strong>Job:</strong> {{ job.title }}</p>
                <p><strong>Worker:</strong> {{ application.worker.name }} ({{ application.worker.phone }})</p>
                <p><strong>Agreed Amount:</strong> <span class="font-semibold text-green-600">₹{{ "%.2f"|format(job.salary) }}</span></p>
            </div>

             {# Record Payment Form #}
             {# This route doesn't use WTForms in current implementation #}
            <form method="POST" action="{{ url_for('employer.record_payment', application_id=application.id) }}" enctype="multipart/form-data" class="space-y-5" novalidate>
                 <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                 {# Amount Paid #}
                 <div>
                     <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">Amount Paid (₹)*</label>
                     <input type="number" id="amount" name="amount" required min="0.01" step="0.01"
                            value="{{ '%.2f'|format(job.salary) }}" {# Pre-fill with job salary #}
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                 </div>

                  {# Payment Method #}
                  <div>
                     <label for="method" class="block text-sm font-medium text-gray-700 mb-1">Payment Method*</label>
                     <select id="method" name="method" required
                             class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm bg-white py-2 px-3">
                         <option value="cash" {{ 'selected' if default_method == 'cash' }}>Cash</option>
                         <option value="bank_transfer" {{ 'selected' if default_method == 'bank_transfer' }}>Bank Transfer</option>
                         <option value="other" {{ 'selected' if default_method == 'other' }}>Other Offline</option>
                     </select>
                 </div>

                 {# Transaction ID / Notes #}
                  <div>
                     <label for="transaction_id" class="block text-sm font-medium text-gray-700 mb-1">Transaction Details / Notes (Optional)</label>
                     <input type="text" id="transaction_id" name="transaction_id"
                            placeholder="e.g., UTR Number, Date, Cash handover details"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                 </div>

                 {# Receipt Upload #}
                  <div>
                     <label for="receipt" class="block text-sm font-medium text-gray-700 mb-1">Upload Receipt (Optional)</label>
                     <input type="file" id="receipt" name="receipt"
                            accept=".pdf,.png,.jpg,.jpeg,.webp"
                            class="mt-1 block w-full text-sm text-gray-500 border border-gray-300 rounded-lg cursor-pointer focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-l-md file:border-0 file:text-sm file:font-semibold file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200">
                     <p class="mt-1 text-xs text-gray-500">Upload proof if available (PDF, PNG, JPG). Max 16MB.</p>
                 </div>

                 <div class="pt-5 flex flex-col sm:flex-row gap-4">
                     <button type="submit" class="w-full sm:w-auto inline-flex justify-center py-2.5 px-6 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                        Record Payment
                    </button>
                    <a href="{{ url_for('employer.view_job', job_id=job.id) }}" class="w-full sm:w-auto inline-flex justify-center py-2.5 px-6 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        Cancel
                    </a>
                </div>

            </form>
        </div> {# End Card #}
    </div> {# End Container #}
</div>
{% endblock %}